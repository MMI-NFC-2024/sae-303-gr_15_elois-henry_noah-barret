---
import * as Plot from "@observablehq/plot";
import { JSDOM } from "jsdom";

const { data = [], config = {} } = Astro.props;

const plot = Plot.plot({
  title:
    config.title ?? "Comparatif des émissions de CO₂ par mode de transport",
  subtitle:
    config.subtitle ??
    "Sources : Données d’émission pour les trajets en France",
  caption:
    config.caption ?? "Chaque barre représente les émissions par passager.",
  ariaLabel:
    config.ariaLabel ?? "Diagramme des émissions de CO₂ par mode de transport.",
  marks: [
    Plot.barY(data, {
      x: "mode",
      y: "CO2e",
      fill: (d: any) => d.mode,
      title: (d: any) => `${d.mode} : ${Number(d.CO2e).toFixed(1)} kg CO₂e`,
    }),
    Plot.text(data, {
      x: "mode",
      y: (d: any) => d.CO2e + 2,
      text: (d: any) => `${Number(d.CO2e).toFixed(1)} kg`,
      textAnchor: "middle",
      fontWeight: "bold",
    }),
    Plot.ruleY([0]),
  ],

  ...config,
  document: new JSDOM("").window.document,
});
---

<figure class="plot-figure">
  <div set:html={plot.outerHTML} />
  <figcaption>
    Émissions de CO₂ (kg/passager) selon le mode de transport.
  </figcaption>
</figure>
